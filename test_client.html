<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Record OGG Audio</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      body {
        width: 100vw;
        min-height: 100svh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 16px;
        font-family: sans-serif;
      }
      p {
        color: grey;
      }
      button {
        font-size: 16px;
        padding: 16px 32px;
        border-radius: 40px;
        color: white;
        font-weight: bold;
        background-color: #ff2036;
        width: 170px;
      }
    </style>
  </head>
  <body>
    <p>Hold to record, release to save</p>
    <button id="recordBtn">Record</button>
    <script>
      const client = "web-test";
      const key = "tk-2a5729c1-309b-40b2-a61e";
      const host = "http://localhost:4000";
      let mediaRecorder;
      let chunks = [];

      const recordBtn = document.getElementById("recordBtn");

      recordBtn.addEventListener("click", async () => {
        if (!mediaRecorder) {
          const stream = await navigator.mediaDevices.getUserMedia({
            audio: true,
          });
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
          mediaRecorder.onstop = async () => {
            // Generate blob
            const blob = new Blob(chunks, { type: "audio/ogg" });

            // Send to server
            const res = await fetch(`${host}/v1/inbox/${key}/${client}`, {
              method: "POST",
              body: blob,
            });
            const data = await res.json();
            console.log(data);
          };
        }

        if (mediaRecorder.state === "recording") {
          mediaRecorder.stop();
          recordBtn.textContent = "Record";
        } else {
          chunks = [];
          mediaRecorder.start();
          recordBtn.textContent = "Recording...";
        }
      });
    </script>
  </body>
</html>
