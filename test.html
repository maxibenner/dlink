<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Record OGG Audio</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 2em;
      }
      button {
        font-size: 1.2em;
        padding: 1em 2em;
      }
    </style>
  </head>
  <body>
    <h2>Hold to Record, Release to Save</h2>
    <button id="recordBtn">Hold to Record</button>
    <script>
      let mediaRecorder;
      let chunks = [];

      const recordBtn = document.getElementById("recordBtn");

      recordBtn.addEventListener("mousedown", async () => {
        if (!mediaRecorder) {
          const stream = await navigator.mediaDevices.getUserMedia({
            audio: true,
          });
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
          mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, { type: "audio/ogg" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "voice.ogg";
            document.body.appendChild(a);
            a.click();
            setTimeout(() => {
              document.body.removeChild(a);
              URL.revokeObjectURL(url);
              chunks = [];
            }, 100);
          };
        }
        chunks = [];
        mediaRecorder.start();
        recordBtn.textContent = "Recording...";
      });

      recordBtn.addEventListener("mouseup", () => {
        if (mediaRecorder && mediaRecorder.state === "recording") {
          mediaRecorder.stop();
          recordBtn.textContent = "Hold to Record";
        }
      });

      // For touch devices
      recordBtn.addEventListener("touchstart", async (e) => {
        e.preventDefault();
        recordBtn.dispatchEvent(new Event("mousedown"));
      });
      recordBtn.addEventListener("touchend", (e) => {
        e.preventDefault();
        recordBtn.dispatchEvent(new Event("mouseup"));
      });
    </script>
  </body>
</html>
